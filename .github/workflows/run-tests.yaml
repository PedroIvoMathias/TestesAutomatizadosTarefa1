name: Rodar Todos os Testes

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Verificar versão do Edge
        id: check_edge_version
        run: |
          $edgePath = "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe"
          $edgeVersion = (Get-ItemProperty -Path $edgePath).Version
          $majorVersion = $edgeVersion.Split('.')[0]
          echo "Versão do Edge: $edgeVersion"
          echo "Versão major: $majorVersion"
          echo "::set-output name=major_version::$majorVersion"

      - name: Baixar EdgeDriver
        id: download_edge_driver
        run: |
          $majorVersion = ${{ steps.check_edge_version.outputs.major_version }}
          $driverUrl = "https://msedgedriver.azureedge.net/$majorVersion.0/$majorVersion.0.0/edgedriver_win64.zip"
          echo "Baixando EdgeDriver de: $driverUrl"
          Invoke-WebRequest -Uri $driverUrl -OutFile "edgedriver.zip"

      - name: Extrair EdgeDriver
        run: |
          Expand-Archive -Path "edgedriver.zip" -DestinationPath "C:\drivers"

      - name: Configurar o PATH do EdgeDriver
        run: |
          $env:Path += ";C:\drivers"
          Write-Host "EdgeDriver configurado no PATH"

      - name: Instalar Dependências do Projeto
        run: |
          # Instalar dependências do .NET (ajuste se usar outro gerenciador de pacotes)
          dotnet restore

      - name: Rodar todos os testes
        run: |
          # Rodando todos os testes (incluindo Selenium)
          dotnet test --configuration Release
